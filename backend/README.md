# File Share Backend - ç‹¬ç«‹æ–‡ä»¶å…±äº«æœåŠ¡

è¿™æ˜¯ä»uToolsæ’ä»¶è½¬æ¢è€Œæ¥çš„ç‹¬ç«‹Node.jsåç«¯æœåŠ¡ï¼Œæä¾›å±€åŸŸç½‘æ–‡ä»¶å…±äº«åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸŒ å±€åŸŸç½‘æ–‡ä»¶å…±äº«
- ğŸ“ æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- ğŸ”’ å¯é€‰å¯†ç è®¤è¯
- ğŸ“ æ–‡æœ¬æ¶ˆæ¯åˆ†äº«
- ğŸ“¦ ç›®å½•å‹ç¼©ä¸‹è½½
- ğŸ¯ å®æ—¶äº‹ä»¶æ¨é€ (SSE)
- ğŸ”§ çµæ´»é…ç½®é€‰é¡¹

## å®‰è£…ä¸è¿è¡Œ

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. å¯åŠ¨æœåŠ¡

#### æ–¹å¼1: ä½¿ç”¨npmè„šæœ¬ (æ¨è)
```bash
# å‰å°å¯åŠ¨
npm run run

# åå°å¯åŠ¨
npm run run-bg

# åœæ­¢åå°æœåŠ¡
npm run stop

# å¿«é€Ÿå¯åŠ¨
npm run quick-start
```

#### æ–¹å¼2: ç›´æ¥å¯åŠ¨
```bash
# è‡ªåŠ¨å¯åŠ¨æœåŠ¡å™¨
node src/index.js --start

# æŒ‡å®šç«¯å£å¯åŠ¨
node src/index.js --port 8080 --start

# æŒ‡å®šä¸Šä¼ è·¯å¾„
node src/index.js --upload-path /path/to/uploads --start

# å¯ç”¨è®¤è¯
node src/index.js --auth --password mypassword --start

# ç»„åˆä½¿ç”¨
node src/index.js --port 8080 --upload-path /home/user/uploads --auth --password secret --start
```

#### æ–¹å¼3: ä½¿ç”¨å¯åŠ¨è„šæœ¬
```bash
# å‰å°å¯åŠ¨
node start.js

# åå°å¯åŠ¨
node run.js --background

# åœæ­¢åå°æœåŠ¡
node stop.js
```

#### æ–¹å¼4: è·¨å¹³å°è„šæœ¬
```bash
# Windows
start.bat

# Linux/Mac
./start.sh
```

### 3. å¼€å‘æ¨¡å¼

```bash
npm run dev
```

## é…ç½®é€‰é¡¹

### å‘½ä»¤è¡Œå‚æ•°

- `--start`: è‡ªåŠ¨å¯åŠ¨æœåŠ¡å™¨
- `--port <ç«¯å£å·>`: è®¾ç½®æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 5421)
- `--upload-path <è·¯å¾„>`: è®¾ç½®æ–‡ä»¶ä¸Šä¼ è·¯å¾„
- `--auth --password <å¯†ç >`: å¯ç”¨è®¤è¯å¹¶è®¾ç½®å¯†ç 
- `--help, -h`: æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

### é»˜è®¤é…ç½®

- **ç«¯å£**: 5421
- **ä¸Šä¼ è·¯å¾„**: ç³»ç»Ÿä¸‹è½½æ–‡ä»¶å¤¹
- **è®¤è¯**: ç¦ç”¨
- **IPåœ°å€**: è‡ªåŠ¨æ£€æµ‹å±€åŸŸç½‘IP

## ä½¿ç”¨è¯´æ˜

### 1. å¯åŠ¨æœåŠ¡åè®¿é—®

æ‰“å¼€æµè§ˆå™¨è®¿é—®æ˜¾ç¤ºçš„åœ°å€ï¼Œä¾‹å¦‚: `http://192.168.1.100:5421`

### 2. æ–‡ä»¶æ“ä½œ

- **ä¸Šä¼ æ–‡ä»¶**: æ‹–æ‹½æ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸ
- **åˆ†äº«æ–‡æœ¬**: åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥å†…å®¹å¹¶å‘é€
- **ä¸‹è½½æ–‡ä»¶**: ç‚¹å‡»æ–‡ä»¶åæˆ–ä¸‹è½½æŒ‰é’®
- **åˆ é™¤æ–‡ä»¶**: ç‚¹å‡»åˆ é™¤æŒ‰é’®

### 3. ç®¡ç†åŠŸèƒ½

- æŸ¥çœ‹æ‰€æœ‰å…±äº«æ–‡ä»¶
- ç®¡ç†ä¸Šä¼ è·¯å¾„
- é…ç½®è®¤è¯è®¾ç½®
- æŸ¥çœ‹æœåŠ¡çŠ¶æ€

## APIæ¥å£

### æ–‡ä»¶åˆ—è¡¨
```
GET /api/files?path=<è·¯å¾„>
```

### æ–‡ä»¶ä¸‹è½½
```
GET /api/download?filename=<æ–‡ä»¶å>&token=<è®¤è¯token>&timestamp=<æ—¶é—´æˆ³>
```

### æ–‡ä»¶ä¸Šä¼ 
```
POST /api/addFile
Content-Type: multipart/form-data
```

### æ–‡æœ¬åˆ†äº«
```
POST /api/addText
Content-Type: application/json
Body: {"message": "æ–‡æœ¬å†…å®¹"}
```

### ç”¨æˆ·è®¤è¯
```
POST /api/login
Content-Type: application/json
Body: {"password": "å¯†ç "}
```

### å®æ—¶äº‹ä»¶
```
GET /api/registrySSE
```

## æ•°æ®å­˜å‚¨

- é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨: `~/.file-share-backend/storage.json`
- ä¸´æ—¶æ–‡ä»¶å­˜å‚¨åœ¨ç³»ç»Ÿä¸´æ—¶ç›®å½•
- ä¸Šä¼ æ–‡ä»¶å­˜å‚¨åœ¨é…ç½®çš„ä¸Šä¼ è·¯å¾„

## å®‰å…¨è¯´æ˜

- é»˜è®¤æƒ…å†µä¸‹ä¸å¯ç”¨è®¤è¯ï¼Œä»»ä½•èƒ½è®¿é—®è¯¥åœ°å€çš„ç”¨æˆ·éƒ½å¯ä»¥æ“ä½œ
- å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨è®¤è¯åŠŸèƒ½
- æœåŠ¡ä»…ç»‘å®šåˆ°å±€åŸŸç½‘IPï¼Œä¸ä¼šæš´éœ²åˆ°å…¬ç½‘

## æ•…éšœæ’é™¤

### ç«¯å£è¢«å ç”¨
```bash
# ä½¿ç”¨å…¶ä»–ç«¯å£
node src/index.js --port 8080 --start
```

### æƒé™é—®é¢˜
```bash
# ç¡®ä¿ä¸Šä¼ è·¯å¾„æœ‰å†™å…¥æƒé™
chmod 755 /path/to/upload/directory
```

### ç½‘ç»œè®¿é—®é—®é¢˜
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- ç¡®è®¤IPåœ°å€æ­£ç¡®
- éªŒè¯ç«¯å£æ˜¯å¦å¼€æ”¾

## ä»uToolsè¿ç§»

è¿™ä¸ªåç«¯æœåŠ¡å®Œå…¨å…¼å®¹åŸuToolsæ’ä»¶çš„åŠŸèƒ½ï¼š

1. ä¿æŒäº†ç›¸åŒçš„APIæ¥å£
2. å…¼å®¹ç›¸åŒçš„æ–‡ä»¶æ ¼å¼
3. æ”¯æŒç›¸åŒçš„é…ç½®é€‰é¡¹
4. æä¾›ç›¸åŒçš„ç”¨æˆ·ä½“éªŒ

ä¸»è¦å˜åŒ–ï¼š
- ç§»é™¤äº†uToolsç‰¹å®šçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å­˜å‚¨æ›¿ä»£uToolsæ•°æ®åº“
- æ·»åŠ äº†å‘½ä»¤è¡Œé…ç½®é€‰é¡¹
- æ”¯æŒç‹¬ç«‹è¿è¡Œ

## å¼€å‘

### é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js          # ä¸»å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ utils/            # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ Database.js   # æ•°æ®å­˜å‚¨
â”‚       â”œâ”€â”€ EventDispatcher.js # äº‹ä»¶åˆ†å‘
â”‚       â”œâ”€â”€ FileDb.js     # æ–‡ä»¶æ•°æ®åº“
â”‚       â”œâ”€â”€ FileUtil.js   # æ–‡ä»¶å·¥å…·
â”‚       â”œâ”€â”€ IpUtil.js     # IPå·¥å…·
â”‚       â”œâ”€â”€ Server.js     # ExpressæœåŠ¡å™¨
â”‚       â”œâ”€â”€ Setting.js    # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ SseUtil.js    # SSEå·¥å…·
â”‚       â”œâ”€â”€ ZipUtil.js    # å‹ç¼©å·¥å…·
â”‚       â””â”€â”€ open-file-explorer/ # æ–‡ä»¶ç®¡ç†å™¨
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

### æ‰©å±•åŠŸèƒ½

å¯ä»¥é€šè¿‡ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶æ¥æ‰©å±•åŠŸèƒ½ï¼š

- `src/utils/Server.js`: æ·»åŠ æ–°çš„APIæ¥å£
- `src/utils/Setting.js`: æ·»åŠ æ–°çš„é…ç½®é€‰é¡¹
- `src/utils/FileDb.js`: æ‰©å±•æ–‡ä»¶æ•°æ®åº“åŠŸèƒ½

## è®¸å¯è¯

MIT License
